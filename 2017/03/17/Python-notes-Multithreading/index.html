<!DOCTYPE html><html lang="English"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Python_notes_Multithreading | PrivateHome</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python_notes_Multithreading</h1><a id="logo" href="/.">PrivateHome</a><p class="description">Personal recordings</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python_notes_Multithreading</h1><div class="post-meta">Mar 17, 2017<span> | </span><span class="category"><a href="/categories/Python-notes/">Python notes</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple-concurrent-programming"><span class="toc-number">1.</span> <span class="toc-text">Simple concurrent programming</span></a></li></ol></div></div><div class="post-content"><h3 id="Simple-concurrent-programming"><a href="#Simple-concurrent-programming" class="headerlink" title="Simple concurrent programming"></a>Simple concurrent programming</h3><a id="more"></a>
<div style="text-align:justify">Thread lock example</div><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">import treading</div><div class="line">import time</div><div class="line">import urllib2</div><div class="line">def url_code(URL):</div><div class="line">    response = None</div><div class="line">    time.sleep(100) <span class="comment"># To make sure the main thread will exist</span></div><div class="line">    try:</div><div class="line">        response = urllib2.urlopen(URL)</div><div class="line">    except urllib2.URLError as e:</div><div class="line">        <span class="built_in">print</span> e.code</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="built_in">print</span> <span class="string">'200'</span></div><div class="line">    finally:</div><div class="line">        <span class="keyword">if</span> response:</div><div class="line">            response.close()</div><div class="line"></div><div class="line"></div><div class="line">urlinfo = [<span class="string">'http://www.sohu.com'</span>,<span class="string">'http://www.163.com'</span>,<span class="string">'http://www.sina.com'</span>]</div><div class="line">    </div><div class="line">ts = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> urlinfo:</div><div class="line">    th = threading.Thread(target = url_code, args = [i])</div><div class="line">    ts.append(th)</div><div class="line">    </div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ts:</div><div class="line">    i.daemon = True   <span class="comment"># To make sure child thread will exit</span></div><div class="line">    i.start()</div><div class="line">    </div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ts:</div><div class="line">    i.join()</div><div class="line">      </div><div class="line"><span class="keyword">while</span> threading.activeCount() &gt; 0:</div><div class="line">    time.sleep(0.1)    </div><div class="line"><span class="built_in">print</span> <span class="string">"end"</span></div></pre></td></tr></table></figure><br><br><div style="text-align:justify">Check and kill process</div>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ps -A</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">kill</span> pid <span class="comment">#pid is used to mark progress</span></div></pre></td></tr></table></figure>
<div style="text-align:justify">Method acquire() and release(), to ensure there is no error when edit the content of someting.</div><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding = utf-8</span></div><div class="line">import threading</div><div class="line">import time</div><div class="line"></div><div class="line"></div><div class="line">count = 500</div><div class="line">mlock= threading.Lock()</div><div class="line"></div><div class="line">def pos():</div><div class="line">    global count</div><div class="line">    mlock.acquire()</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(0,100):</div><div class="line">        count += 1</div><div class="line">    mlock.release()</div><div class="line">    </div><div class="line">threads = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(0,10):</div><div class="line">    th = threading.Thread(target = pos)</div><div class="line">    th.start()</div><div class="line">    threads.append(th)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> threads:</div><div class="line">    i.join()</div><div class="line"></div><div class="line"><span class="built_in">print</span> count</div></pre></td></tr></table></figure><br><br><div style="text-align:justify">Another example, to apply multi-threading to get the title and content of a website.</div><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">def open_url_content(URL):</div><div class="line">    try:</div><div class="line">        u = urllib.urlopen(URL)</div><div class="line">    except IOError as e:</div><div class="line">        <span class="built_in">print</span> <span class="string">"ileagal link"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        re_title = <span class="string">'&lt;title&gt;(.*)&lt;/title&gt;&lt;/head&gt;'</span>    <span class="comment">#regular expression</span></div><div class="line">        title = re.findall(re_title,u)</div><div class="line">        u.close()</div><div class="line">        <span class="built_in">print</span> title[0],u</div><div class="line"></div><div class="line">urlinfo = [<span class="string">'http://www.sohu.com'</span>,<span class="string">'http://www.163.com'</span>,<span class="string">'http://www.sina.com'</span>]</div><div class="line"></div><div class="line">ts = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(0,len(urlinfo)):</div><div class="line">    th = threading.Thread(target = open_url_content, args = [i])</div><div class="line">    i.start()</div><div class="line">    ts.append(th)</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ts:</div><div class="line">    i.join()</div><div class="line">  </div><div class="line"><span class="built_in">print</span> <span class="string">"end"</span></div></pre></td></tr></table></figure><br><br><div style="text-align:justify">If there are too many website links need to be processed, we need to apply queue. For example, we can first apply 50 threads to run, then next 50 in the queue.</div></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://private100.github.io/2017/03/17/Python-notes-Multithreading/" data-id="cj5pfricd000blsmvdtp1yqvx" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/Multithreading/">Multithreading</a></div><div class="post-nav"><a href="/2017/03/21/Python-notes-YieldGenerator/" class="pre">Python-notes-YieldGenerator</a><a href="/2017/03/14/Python-notes-logging/" class="next">Python_notes_Logging</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://private100.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Group-Project/">Group Project</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS-notes/">JS notes</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python-notes/">Python notes</a><span class="category-list-count">9</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Regular-Expression/" style="font-size: 15px;">Regular Expression</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/json-server/" style="font-size: 15px;">json-server</a> <a href="/tags/http/" style="font-size: 15px;">$http</a> <a href="/tags/bs/" style="font-size: 15px;">bs</a> <a href="/tags/Multithreading/" style="font-size: 15px;">Multithreading</a> <a href="/tags/Douglas-Peucker/" style="font-size: 15px;">Douglas-Peucker</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a> <a href="/tags/Socket/" style="font-size: 15px;">Socket</a> <a href="/tags/URLError/" style="font-size: 15px;">URLError</a> <a href="/tags/Logging/" style="font-size: 15px;">Logging</a> <a href="/tags/Yield/" style="font-size: 15px;">Yield</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/28/JavaScript-Angular-http/">JavaScript_Angular_http</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/28/Python-notes-logging2/">Python_notes_Logging2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/15/JavaScript-Angular-json-server/">JavaScript_json_server</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/15/Python-notes-URLError/">Python_notes_URLError</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/Python-notes-BeautifulSoup/">Python-notes-BeautifulSoup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/08/Python-notes-Scrapy/">Python-notes-Scrapy</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/28/Python-notes-Socket/">Python-notes-Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/25/Python-notes-Regular-Expression/">Python-notes-Regular-Expression</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/21/Python-notes-YieldGenerator/">Python-notes-YieldGenerator</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/17/Python-notes-Multithreading/">Python_notes_Multithreading</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">PrivateHome.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>